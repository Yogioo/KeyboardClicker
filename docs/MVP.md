### **终极网格坐标系统 v2.0 - MVP (最小可行产品) 定义文档**

**版本:** 1.0
**日期:** 2025年8月15日

#### **1. 愿景 (Vision)**

为键盘重度使用者打造一个“所见即所得，所想即所达”的零延迟屏幕交互工具。通过将屏幕选择转化为直观、高效的键盘指令，彻底消除从“定位”到“执行”之间的时间鸿沟。

#### **2. MVP 目标 (Goal of the MVP)**

**核心目标：** 验证核心交互流程——**通过连续按键实现屏幕区域的递归定位，并以默认左键单击作为终结操作**——是否比传统鼠标操作更高效、更直观。

此 MVP 版本将专注于实现最核心、最高频的使用场景，并确保其稳定可靠。

#### **3. 核心功能范围 (In-Scope Features)**

以下功能是构成 MVP 的必要组成部分，将按照我们设计的模块化架构进行开发和测试。

**3.1. 功能模块一：网格激活与可视化**
*   **全局热键启动**: 用户可以通过一个预设的、系统级的热键（例如 `Alt+G`）随时激活或取消网格系统。
*   **基础网格叠加层**:
    *   激活后，屏幕上会显示一个覆盖**主显示器**全屏的半透明九宫格（3x3）叠加层。
    *   界面应极简，不应妨碍用户看清底层窗口内容。
*   **路径指示器**: 在屏幕的固定位置（如顶部中央），实时显示用户当前输入的按键路径（例如 `E -> D`）。

**3.2. 功能模块二：递归定位与反馈**
*   **“打字式”定位**: 用户按下九宫格对应的按键（`QWEASDZXC`）后，网格会立即递归到对应的子区域。
*   **实时视觉更新**: 网格的分割线和路径指示器会随着每一次按键实时、无延迟地更新。
*   **退出机制**: 提供一个明确的退出键（例如 `Esc` 或再次按下热键），可以随时放弃当前操作并隐藏网格。

**3.3. 功能模块三：核心指令化操作**
为了验证指令系统的核心价值，MVP 将实现以下三个最基础、最关键的操作：

*   **默认左键单击 (Default Left Click)**:
    *   **这是 MVP 的核心**。当用户输入完成路径的最后一位按键时，系统会**立即**在目标区域的中心点执行一次**左键单击**，然后自动退出网格模式。这是最高优先级的默认行为。
*   **右键单击 (Right Click)**:
    *   用户在路径后追加一个指令后缀 `R`（例如 `EDCR`），即可在目标位置执行一次**右键单击**。
*   **悬停/移动 (Hover)**:
    *   用户在路径后追加一个指令后缀 `H`（例如 `EDCH`），光标会移动到目标位置，然后系统**仅退出网格模式，不执行任何点击**。这用于定位光标或与需要悬停触发的UI元素交互。

#### **4. 范围之外的功能 (Out-of-Scope for MVP)**

为了保持 MVP 的专注和简洁，以下功能将**不包含**在第一个版本中，但会作为后续迭代的重要候选：

*   **❌ 可视化拖拽操作**: 拖拽的实现（标记起点、绘制引导线、选择终点）相对复杂，将推迟到核心定位与点击功能被验证后。
*   **❌ 双击指令**: `D` 后缀的双击操作使用频率低于右键单击，暂不实现。
*   **❌ 4x3 或其他网格布局**: MVP 将固定使用 3x3 九宫格以最快形成肌肉记忆。后续可拓展为可配置项。
*   **❌ 复杂的设置界面**: 所有配置（如热键、颜色、透明度）将在代码中硬编码，不提供图形化的设置界面。
*   **❌ 多显示器高级支持**: MVP 将优先保证在主显示器上的完美运行。跨显示器、选择特定显示器的功能将延后。
*   **❌ 任何形式的动画效果**: 所有视觉反馈都应是即时的，不加入渐入渐出等动画效果。

#### **5. 技术栈 (Technology Stack)**

*   **语言**: Python
*   **UI 框架**: PyQt6 (用于实现透明叠加层和视觉反馈)
*   **平台库**: 使用 `pynput` 或类似的库进行全局热键监听和底层鼠标控制。
*   **目标平台**: Windows

#### **6. 验收标准 (Acceptance Criteria)**

*   **功能完整性**: 所有“核心功能范围”中定义的功能都已实现。
*   **测试覆盖**: `core`, `platform`, `ui` 三个核心目录下的所有模块，都拥有对应的单元测试，且测试通过率达到100%。
*   **稳定性**: 应用程序可以长时间在后台运行而不会崩溃或造成明显的性能问题。
*   **核心体验**: 在一个无干扰的环境下，完成一次“激活 -> 定位 -> 单击”的操作流程，体感上流畅且无卡顿。

---

本文档确立了"终极网格坐标系统 v2.0"的第一个里程碑。开发团队应严格遵守此范围，避免范围蔓延，以确保我们能够快速、高效地交付一个有价值的核心产品。

---

## **7. 开发任务分解与实施计划**

### **7.1 系统架构设计阶段**

**任务1: 核心架构模块定义**
- **目标**: 建立清晰的模块边界和接口定义
- **交付物**: 
  - `src/core/` - 核心业务逻辑模块
  - `src/platform/` - 平台相关操作模块  
  - `src/ui/` - 用户界面模块
- **优先级**: 最高 (P0)
- **预估工期**: 1天

### **7.2 核心功能开发阶段**

**任务2: 功能模块一 - 网格激活与可视化系统**
- **目标**: 实现全局热键启动和基础网格叠加层
- **详细子任务**:
  - 全局热键监听系统 (`Alt+G`)
  - 主显示器3x3网格叠加层渲染
  - 路径指示器UI组件
  - 退出机制 (`Esc`键)
- **技术要点**: PyQt6透明窗口、pynput全局键盘监听
- **优先级**: 最高 (P0)
- **预估工期**: 2天

**任务3: 功能模块二 - 递归定位与反馈系统**
- **目标**: 实现"打字式"定位和实时视觉更新
- **详细子任务**:
  - 九宫格按键映射系统 (`QWEASDZXC`)
  - 递归区域计算算法
  - 实时网格更新渲染
  - 按键路径状态管理
- **技术要点**: 坐标计算、状态机设计
- **优先级**: 最高 (P0)
- **预估工期**: 2天

**任务4: 功能模块三 - 核心指令化操作系统**
- **目标**: 实现三种基础操作指令
- **详细子任务**:
  - 默认左键单击 (最高优先级)
  - 右键单击指令 (`R`后缀)
  - 悬停/移动指令 (`H`后缀)
  - 指令解析与执行引擎
- **技术要点**: 鼠标控制、指令解析
- **优先级**: 最高 (P0)
- **预估工期**: 1.5天

### **7.3 质量保证阶段**

**任务5: 单元测试开发**
- **目标**: 100%测试覆盖率
- **详细子任务**:
  - `tests/core/` - 核心逻辑测试
  - `tests/platform/` - 平台操作测试
  - `tests/ui/` - UI组件测试
  - 集成测试套件
- **优先级**: 高 (P1)
- **预估工期**: 2天

**任务6: 性能与稳定性测试**
- **目标**: 验证长时间运行稳定性
- **详细子任务**:
  - 内存泄漏检测
  - 响应延迟测试 (<50ms)
  - 长时间运行稳定性测试 (24小时+)
  - 系统资源占用监控
- **优先级**: 高 (P1)
- **预估工期**: 1天

### **7.4 验收与交付阶段**

**任务7: 用户体验验证**
- **目标**: 验证核心交互流程的直观性和效率
- **详细子任务**:
  - "激活 -> 定位 -> 单击"流程测试
  - 与传统鼠标操作的效率对比
  - 肌肉记忆形成难度评估
- **优先级**: 中 (P2)
- **预估工期**: 0.5天

### **7.5 实施时间表**

| 阶段 | 任务 | 工期 | 依赖关系 |
|------|------|------|----------|
| 第1天 | 任务1: 架构设计 | 1天 | - |
| 第2-3天 | 任务2: 网格系统 | 2天 | 任务1 |
| 第4-5天 | 任务3: 定位系统 | 2天 | 任务1,2 |
| 第6-7天 | 任务4: 指令系统 | 1.5天 | 任务1,2,3 |
| 第8-9天 | 任务5: 单元测试 | 2天 | 任务2,3,4 |
| 第10天 | 任务6: 性能测试 | 1天 | 任务5 |
| 第11天 | 任务7: 验收测试 | 0.5天 | 任务6 |

**总预估工期**: 10.5个工作日

### **7.6 风险控制与应急计划**

**高风险项**:
1. **全局热键冲突**: 建立热键检测机制，提供替代方案
2. **透明叠加层兼容性**: 多Windows版本测试，降级方案准备
3. **响应延迟超标**: 性能分析工具准备，算法优化预案

**质量检查点**:
- 每个任务完成后进行功能验证
- 每2天进行一次集成测试
- 第7天进行中期里程碑评审