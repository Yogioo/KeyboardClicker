# 用户界面模块 TODO (UI Module)

**模块路径**: `src/ui/`  
**优先级**: P0 (最高)  
**预估工期**: 3天  

## 概述
用户界面模块负责实现透明网格叠加层和可视化反馈，提供直观的用户交互体验。

---

## #region 透明叠加层系统 (第1天)

### ✅ OverlayWindow 实现
- [ ] **基础透明窗口**
  - [ ] 基于 PyQt6 的全屏透明窗口
  - [ ] 窗口置顶属性设置
  - [ ] 鼠标穿透配置 (点击穿透到底层)
  - [ ] 窗口边框和标题栏隐藏

- [ ] **窗口生命周期管理**
  - [ ] `Show()` - 显示叠加层
  - [ ] `Hide()` - 隐藏叠加层
  - [ ] `UpdateVisibility(isVisible)` - 切换可见性
  - [ ] 资源清理与释放

### ✅ 屏幕适配系统
- [ ] **多分辨率支持**
  - [ ] 获取主显示器分辨率
  - [ ] DPI自适应缩放
  - [ ] 全屏窗口精确定位
  - [ ] 坐标系统校准

- [ ] **显示器兼容性**
  - [ ] 1080p显示器测试
  - [ ] 1440p显示器测试
  - [ ] 4K显示器基础支持
  - [ ] 非标准分辨率处理

---

## #region 网格渲染系统 (第1.5天)

### ✅ GridRenderer 实现
- [ ] **3x3网格绘制**
  - [ ] `RenderGrid(gridRect)` - 渲染网格线
  - [ ] 网格线颜色与粗细定义
  - [ ] 透明度控制 (建议 60-80%)
  - [ ] 抗锯齿处理

- [ ] **递归网格更新**
  - [ ] `UpdateGrid(newRegion)` - 更新网格区域
  - [ ] 平滑的区域切换
  - [ ] 网格线重绘优化
  - [ ] 避免闪烁问题

### ✅ 视觉样式设计
- [ ] **网格样式配置**
  - [ ] 网格线颜色: `#00FF00` (绿色)
  - [ ] 网格线宽度: 2px
  - [ ] 背景透明度: 10%
  - [ ] 活跃区域高亮

- [ ] **按键标识显示**
  - [ ] 每个网格单元显示对应按键 (`Q`, `W`, `E`, etc.)
  - [ ] 按键字体与大小
  - [ ] 按键位置 (单元格左上角)
  - [ ] 按键颜色与对比度

---

## #region 路径指示器系统 (第0.5天)

### ✅ PathIndicator 实现
- [ ] **路径显示组件**
  - [ ] 固定位置显示 (屏幕顶部中央)
  - [ ] `UpdatePath(keySequence)` - 更新按键路径
  - [ ] 路径格式: `Q → W → E`
  - [ ] 最大显示长度限制

- [ ] **路径视觉设计**
  - [ ] 路径背景: 半透明黑色
  - [ ] 路径文字: 白色，较大字体
  - [ ] 路径边框: 圆角矩形
  - [ ] 淡入淡出效果 (可选)

### ✅ 状态指示器
- [ ] **系统状态显示**
  - [ ] 网格激活状态指示
  - [ ] 当前递归层级显示
  - [ ] 错误状态提示
  - [ ] 处理中状态动画

---

## #region UI事件处理 (第1天)

### ✅ EventHandler 实现
- [ ] **UI事件分发**
  - [ ] 按键事件接收与处理
  - [ ] 网格更新事件响应
  - [ ] 系统状态变化处理
  - [ ] 错误事件显示

- [ ] **用户反馈机制**
  - [ ] 即时视觉反馈
  - [ ] 操作确认提示
  - [ ] 错误状态警告
  - [ ] 操作取消提示

### ✅ 动画与过渡效果
- [ ] **基础动画效果** (可选)
  - [ ] 网格显示/隐藏过渡
  - [ ] 路径更新动画
  - [ ] 错误提示闪烁
  - [ ] 成功操作确认

- [ ] **性能优化**
  - [ ] 动画帧率控制 (60fps)
  - [ ] GPU加速渲染 (如可用)
  - [ ] 减少重绘频率
  - [ ] 内存使用优化

---

## 验收标准

### 功能完整性
- [x] 透明叠加层正常显示
- [x] 3x3网格准确渲染
- [x] 路径指示器实时更新
- [x] 各种屏幕分辨率适配

### 视觉质量
- [x] 网格线清晰无锯齿
- [x] 透明度适中，不遮挡底层内容
- [x] 按键标识清晰可读
- [x] 整体视觉协调统一

### 性能指标
- [x] UI响应时间 < 16ms (60fps)
- [x] 内存占用 < 30MB
- [x] CPU占用 < 2%
- [x] 无明显卡顿或闪烁

### 代码质量
- [x] 代码符合Python PEP8规范
- [x] 变量命名遵循约定 (私有变量 `_abc`, 公共 `Abc`)
- [x] 使用 `#region` `#endregion` 组织代码
- [x] PyQt6最佳实践

---

## 测试要求

### 单元测试覆盖率
- [x] OverlayWindow: 100%
- [x] GridRenderer: 100%
- [x] PathIndicator: 100%
- [x] EventHandler: 100%

### UI测试
- [x] 透明窗口显示测试
- [x] 网格渲染精度测试
- [x] 多分辨率适配测试
- [x] 长时间显示稳定性测试

### 视觉测试
- [x] 截图对比测试
- [x] 颜色准确性测试
- [x] 透明度效果测试
- [x] 字体清晰度测试

---

## 依赖与风险

### 外部依赖
- **PyQt6**: 主要UI框架
- **QPainter**: 图形绘制
- **QTimer**: 动画与定时器

### 设计约束
- **极简设计**: 避免干扰用户
- **即时响应**: 所有UI更新必须实时
- **跨分辨率**: 支持常见分辨率
- **资源节约**: 最小化系统资源占用

### 风险评估
- **中风险**: PyQt6兼容性问题
  - *缓解方案*: 版本锁定，向下兼容测试
- **中风险**: 透明窗口在某些系统不工作
  - *缓解方案*: 降级方案，半透明窗口
- **低风险**: 性能问题
  - *缓解方案*: 渲染优化，减少重绘

---

**依赖关系**: core模块 (状态同步), platform模块 (屏幕信息)  
**被依赖**: 无  
**风险等级**: 中 (UI框架依赖)